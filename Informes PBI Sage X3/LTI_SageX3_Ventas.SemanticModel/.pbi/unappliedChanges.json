{
  "$schema": "https://developer.microsoft.com/json-schemas/fabric/item/semanticModel/unappliedChanges/1.0.0/schema.json",
  "conceptualSchemaSettings": {},
  "queries": [
    {
      "name": "Sales Invoice Line",
      "lineageTag": "821da74c-f6eb-4554-8a9d-531618a48278",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    CurrentRows = Registros,",
        "    CurrentPeriod = Periodo,",
        "    CurrentCompany = Empresa,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "",
        "",
        "DECLARE @ANO1 VARCHAR(20)",
        "DECLARE @ANO2 int",
        "set @ANO1='\"& CurrentPeriod &\"'",
        "set @ANO2=(SELECT MIN(PERIODO) FROM (\tSELECT YEAR(ACCDAT_0) AS PERIODO,COUNT(*) AS REGISTROS,",
        "\t\t\t\t\t\t\t\t\t\tSUM(COUNT(*)) OVER (ORDER BY YEAR(ACCDAT_0) DESC) AS ACUMULADO",
        "\t\t\t\t\t\t\t\t\t\tFROM \" & CurrentSchema &\".SINVOICED as SED left join \" & CurrentSchema &\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0",
        "\t\t\t\t\t\t\t\t\t\twhere SE.ORIMOD_0=5 ",
        "\t\t\t\t\t\t\t\t\t\tGROUP BY YEAR(ACCDAT_0)",
        "\t\t\t\t\t\t\t\t\t\t) A\tWHERE ACUMULADO <=\" & CurrentRows &\")",
        "\t\t\t\t\t\t\t\t\t\t",
        "",
        "IF @ANO1='Periodo automático'",
        "",
        "(",
        "SELECT ",
        "SED.[NUM_0],SED.[SIDLIN_0] ,SED.[CPY_0] ,SED.[BPCINV_0] ,SED.[ITMREF_0] ,SED.[ITMDES1_0] ,SED.[ITMDES_0] ,SED.[REP1_0] ,SED.[REP2_0] ,SED.[GROPRI_0] ,SED.[PRIREN_0] ,SED.[NETPRI_0] ,SED.[NETPRINOT_0]",
        ",SED.[NETPRIATI_0] ,SED.[PFM_0] ,SED.[CPRPRI_0] ,SED.[DISCRGVAL1_0],SED.[DISCRGVAL2_0] ,SED.[DISCRGREN1_0],SED.[DISCRGREN2_0] ,SED.[AMTNOTLIN_0] ,SED.[BASTAXLIN_0] ,SED.[RATTAXLIN_0] ,SED.[AMTTAXLIN_0]",
        ",SED.[AMTATILIN_0] ,SED.[QTY_0] ,SED.[SAU_0] ,SED.[PRIORD_0] ,SED.[VAT_0] ,SE.SNS_0 ,SE.ORIMOD_0, ACCDAT_0 ,SED.QTYSTU_0, SED.STOFCY_0, SYD.BPAADD_0",
        ",(select top 1 ITS.BPSNUM_0 from \" & CurrentSchema &\".ITMBPS ITS where ITS.ITMREF_0 = SED.ITMREF_0 and ITS.PIO_0 = 0) as 'Codigo Proveedor',",
        "(select top 1 BPS.BPSNAM_0 from \" & CurrentSchema &\".ITMBPS ITS inner join \" & CurrentSchema &\".BPSUPPLIER BPS on BPS.BPSNUM_0 = ITS.BPSNUM_0 where ITS.ITMREF_0 = SED.ITMREF_0 and ITS.PIO_0 = 0) as 'Nombre Proveedor'",
        ", (select top 1 ITS.ITMREFBPS_0 from \" & CurrentSchema &\".ITMBPS ITS where ITS.ITMREF_0 = SED.ITMREF_0 and ITS.BPSNUM_0='\" & CurrentCompany &\"') as [Articulo VYGON]",
        "",
        "FROM \" & CurrentSchema &\".SINVOICED as SED left join \" & CurrentSchema &\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0",
        "left join \" & CurrentSchema &\".SDELIVERYD SYD on SYD.SDHNUM_0=SED.SDHNUM_0 and SYD.SDDLIN_0=SED.SDDLIN_0",
        "where SE.ORIMOD_0=5 and INVTYP_0 in (1,2) AND YEAR(ACCDAT_0)>=@ANO2",
        "",
        "",
        ")",
        "",
        "ELSE",
        "",
        "(",
        "SELECT ",
        "SED.[NUM_0],SED.[SIDLIN_0] ,SED.[CPY_0] ,SED.[BPCINV_0] ,SED.[ITMREF_0] ,SED.[ITMDES1_0] ,SED.[ITMDES_0] ,SED.[REP1_0] ,SED.[REP2_0] ,SED.[GROPRI_0] ,SED.[PRIREN_0] ,SED.[NETPRI_0] ,SED.[NETPRINOT_0]",
        ",SED.[NETPRIATI_0] ,SED.[PFM_0] ,SED.[CPRPRI_0] ,SED.[DISCRGVAL1_0],SED.[DISCRGVAL2_0] ,SED.[DISCRGREN1_0],SED.[DISCRGREN2_0] ,SED.[AMTNOTLIN_0] ,SED.[BASTAXLIN_0] ,SED.[RATTAXLIN_0] ,SED.[AMTTAXLIN_0]",
        ",SED.[AMTATILIN_0] ,SED.[QTY_0] ,SED.[SAU_0] ,SED.[PRIORD_0] ,SED.[VAT_0] ,SE.SNS_0 ,SE.ORIMOD_0, ACCDAT_0 ,SED.QTYSTU_0, SED.STOFCY_0, SYD.BPAADD_0",
        ",(select top 1 ITS.BPSNUM_0 from \" & CurrentSchema &\".ITMBPS ITS where ITS.ITMREF_0 = SED.ITMREF_0 and ITS.PIO_0 = 0) as 'Codigo Proveedor',",
        "(select top 1 BPS.BPSNAM_0 from \" & CurrentSchema &\".ITMBPS ITS inner join \" & CurrentSchema &\".BPSUPPLIER BPS on BPS.BPSNUM_0 = ITS.BPSNUM_0 where ITS.ITMREF_0 = SED.ITMREF_0 and ITS.PIO_0 = 0) as 'Nombre Proveedor'",
        ", (select top 1 ITS.ITMREFBPS_0 from \" & CurrentSchema &\".ITMBPS ITS where ITS.ITMREF_0 = SED.ITMREF_0 and ITS.BPSNUM_0='\" & CurrentCompany &\"') as [Articulo VYGON]",
        "",
        "FROM \" & CurrentSchema &\".SINVOICED as SED left join \" & CurrentSchema &\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0",
        "left join \" & CurrentSchema &\".SDELIVERYD SYD on SYD.SDHNUM_0=SED.SDHNUM_0 and SYD.SDDLIN_0=SED.SDDLIN_0",
        "where SE.ORIMOD_0=5 and INVTYP_0 in (1,2) AND YEAR(ACCDAT_0)>=@ANO1",
        "",
        ")     ",
        "        ",
        "        ",
        "        \"",
        "                                                          ]),",
        "    #\"Columnas con nombre cambiado\" = Table.RenameColumns(Origen,{{\"NUM_0\", \"Documento\"}, {\"SIDLIN_0\", \"Linea\"}, {\"CPY_0\", \"Empresa\"}, {\"BPCINV_0\", \"IdCliente\"}, {\"ITMREF_0\", \"IdItem\"}, {\"ITMDES1_0\", \"Descripcion 1\"}, {\"ITMDES_0\", \"Descripcion 2\"}, {\"REP1_0\", \"Comercial 1\"}, {\"REP2_0\", \"Comercial 2\"}, {\"GROPRI_0\", \"Precio Bruto\"}, {\"PRIREN_0\", \"Motivo Precio\"}, {\"NETPRI_0\", \"Precio Neto\"}, {\"NETPRINOT_0\", \"Precio Neto AI\"}, {\"NETPRIATI_0\", \"Precio Neto II\"}, {\"PFM_0\", \"Margen Beneficio\"}, {\"CPRPRI_0\", \"Precio Coste\"}, {\"DISCRGVAL1_0\", \"Valor Descuento 1\"}, {\"DISCRGVAL2_0\", \"Valor Descuento 2\"}, {\"DISCRGREN1_0\", \"Motivo Descuento\"}, {\"DISCRGREN2_0\", \"Motivo Descuento 2\"}, {\"AMTNOTLIN_0\", \"Total Linea Sin Impuesto\"}, {\"BASTAXLIN_0\", \"Importe Imponible\"}, {\"RATTAXLIN_0\", \"Tasa Impuesto\"}, {\"AMTTAXLIN_0\", \"Importe Impuesto\"}, {\"AMTATILIN_0\", \"Total Linea con Impuesto\"}, {\"QTY_0\", \"Cantidad\"}, {\"SAU_0\", \"Unidad Venta\"}, {\"PRIORD_0\", \"Precio Pedido\"}, {\"ACCDAT_0\", \"Fecha Factura\"}, {\"VAT_0\", \"Tipo IVA\"},{\"SNS_0\", \"Sentido Cargo/Abono\"}, {\"ORIMOD_0\", \"Modulo\"},{\"QTYSTU_0\", \"Quantity\"},{\"BPAADD_0\", \"Direccion de envio\"}}),",
        "    #\"Tipo cambiado\" = Table.TransformColumnTypes(#\"Columnas con nombre cambiado\",{{\"Fecha Factura\", type date}})",
        "in",
        "    #\"Tipo cambiado\""
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    CurrentServer = Instancia,\\n    CurrentDatabase = BaseDeDatos,\\n    CurrentSchema = Esquema,\\n    CurrentRows = Registros,\\n    CurrentPeriod = Periodo,\\n    CurrentCompany = Empresa,\\n    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\\\"\\n\\n\\nDECLARE @ANO1 VARCHAR(20)\\nDECLARE @ANO2 int\\nset @ANO1='\\\"& CurrentPeriod &\\\"'\\nset @ANO2=(SELECT MIN(PERIODO) FROM (\\tSELECT YEAR(ACCDAT_0) AS PERIODO,COUNT(*) AS REGISTROS,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tSUM(COUNT(*)) OVER (ORDER BY YEAR(ACCDAT_0) DESC) AS ACUMULADO\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tFROM \\\" & CurrentSchema &\\\".SINVOICED as SED left join \\\" & CurrentSchema &\\\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\twhere SE.ORIMOD_0=5 \\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tGROUP BY YEAR(ACCDAT_0)\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t) A\\tWHERE ACUMULADO <=\\\" & CurrentRows &\\\")\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\n\\nIF @ANO1='Periodo automático'\\n\\n(\\nSELECT \\nSED.[NUM_0],SED.[SIDLIN_0] ,SED.[CPY_0] ,SED.[BPCINV_0] ,SED.[ITMREF_0] ,SED.[ITMDES1_0] ,SED.[ITMDES_0] ,SED.[REP1_0] ,SED.[REP2_0] ,SED.[GROPRI_0] ,SED.[PRIREN_0] ,SED.[NETPRI_0] ,SED.[NETPRINOT_0]\\n,SED.[NETPRIATI_0] ,SED.[PFM_0] ,SED.[CPRPRI_0] ,SED.[DISCRGVAL1_0],SED.[DISCRGVAL2_0] ,SED.[DISCRGREN1_0],SED.[DISCRGREN2_0] ,SED.[AMTNOTLIN_0] ,SED.[BASTAXLIN_0] ,SED.[RATTAXLIN_0] ,SED.[AMTTAXLIN_0]\\n,SED.[AMTATILIN_0] ,SED.[QTY_0] ,SED.[SAU_0] ,SED.[PRIORD_0] ,SED.[VAT_0] ,SE.SNS_0 ,SE.ORIMOD_0, ACCDAT_0 ,SED.QTYSTU_0, SED.STOFCY_0, SYD.BPAADD_0\\n,(select top 1 ITS.BPSNUM_0 from \\\" & CurrentSchema &\\\".ITMBPS ITS where ITS.ITMREF_0 = SED.ITMREF_0 and ITS.PIO_0 = 0) as 'Codigo Proveedor',\\n(select top 1 BPS.BPSNAM_0 from \\\" & CurrentSchema &\\\".ITMBPS ITS inner join \\\" & CurrentSchema &\\\".BPSUPPLIER BPS on BPS.BPSNUM_0 = ITS.BPSNUM_0 where ITS.ITMREF_0 = SED.ITMREF_0 and ITS.PIO_0 = 0) as 'Nombre Proveedor'\\n, (select top 1 ITS.ITMREFBPS_0 from \\\" & CurrentSchema &\\\".ITMBPS ITS where ITS.ITMREF_0 = SED.ITMREF_0 and ITS.BPSNUM_0='\\\" & CurrentCompany &\\\"') as [Articulo VYGON]\\n\\nFROM \\\" & CurrentSchema &\\\".SINVOICED as SED left join \\\" & CurrentSchema &\\\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0\\nleft join \\\" & CurrentSchema &\\\".SDELIVERYD SYD on SYD.SDHNUM_0=SED.SDHNUM_0 and SYD.SDDLIN_0=SED.SDDLIN_0\\nwhere SE.ORIMOD_0=5 and INVTYP_0 in (1,2) AND YEAR(ACCDAT_0)>=@ANO2\\n\\n\\n)\\n\\nELSE\\n\\n(\\nSELECT \\nSED.[NUM_0],SED.[SIDLIN_0] ,SED.[CPY_0] ,SED.[BPCINV_0] ,SED.[ITMREF_0] ,SED.[ITMDES1_0] ,SED.[ITMDES_0] ,SED.[REP1_0] ,SED.[REP2_0] ,SED.[GROPRI_0] ,SED.[PRIREN_0] ,SED.[NETPRI_0] ,SED.[NETPRINOT_0]\\n,SED.[NETPRIATI_0] ,SED.[PFM_0] ,SED.[CPRPRI_0] ,SED.[DISCRGVAL1_0],SED.[DISCRGVAL2_0] ,SED.[DISCRGREN1_0],SED.[DISCRGREN2_0] ,SED.[AMTNOTLIN_0] ,SED.[BASTAXLIN_0] ,SED.[RATTAXLIN_0] ,SED.[AMTTAXLIN_0]\\n,SED.[AMTATILIN_0] ,SED.[QTY_0] ,SED.[SAU_0] ,SED.[PRIORD_0] ,SED.[VAT_0] ,SE.SNS_0 ,SE.ORIMOD_0, ACCDAT_0 ,SED.QTYSTU_0, SED.STOFCY_0, SYD.BPAADD_0\\n,(select top 1 ITS.BPSNUM_0 from \\\" & CurrentSchema &\\\".ITMBPS ITS where ITS.ITMREF_0 = SED.ITMREF_0 and ITS.PIO_0 = 0) as 'Codigo Proveedor',\\n(select top 1 BPS.BPSNAM_0 from \\\" & CurrentSchema &\\\".ITMBPS ITS inner join \\\" & CurrentSchema &\\\".BPSUPPLIER BPS on BPS.BPSNUM_0 = ITS.BPSNUM_0 where ITS.ITMREF_0 = SED.ITMREF_0 and ITS.PIO_0 = 0) as 'Nombre Proveedor'\\n, (select top 1 ITS.ITMREFBPS_0 from \\\" & CurrentSchema &\\\".ITMBPS ITS where ITS.ITMREF_0 = SED.ITMREF_0 and ITS.BPSNUM_0='\\\" & CurrentCompany &\\\"') as [Articulo VYGON]\\n\\nFROM \\\" & CurrentSchema &\\\".SINVOICED as SED left join \\\" & CurrentSchema &\\\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0\\nleft join \\\" & CurrentSchema &\\\".SDELIVERYD SYD on SYD.SDHNUM_0=SED.SDHNUM_0 and SYD.SDDLIN_0=SED.SDDLIN_0\\nwhere SE.ORIMOD_0=5 and INVTYP_0 in (1,2) AND YEAR(ACCDAT_0)>=@ANO1\\n\\n)     \\n        \\n        \\n        \\\"\\n                                                          ]),\\n    #\\\"Columnas con nombre cambiado\\\" = Table.RenameColumns(Origen,{{\\\"NUM_0\\\", \\\"Documento\\\"}, {\\\"SIDLIN_0\\\", \\\"Linea\\\"}, {\\\"CPY_0\\\", \\\"Empresa\\\"}, {\\\"BPCINV_0\\\", \\\"IdCliente\\\"}, {\\\"ITMREF_0\\\", \\\"IdItem\\\"}, {\\\"ITMDES1_0\\\", \\\"Descripcion 1\\\"}, {\\\"ITMDES_0\\\", \\\"Descripcion 2\\\"}, {\\\"REP1_0\\\", \\\"Comercial 1\\\"}, {\\\"REP2_0\\\", \\\"Comercial 2\\\"}, {\\\"GROPRI_0\\\", \\\"Precio Bruto\\\"}, {\\\"PRIREN_0\\\", \\\"Motivo Precio\\\"}, {\\\"NETPRI_0\\\", \\\"Precio Neto\\\"}, {\\\"NETPRINOT_0\\\", \\\"Precio Neto AI\\\"}, {\\\"NETPRIATI_0\\\", \\\"Precio Neto II\\\"}, {\\\"PFM_0\\\", \\\"Margen Beneficio\\\"}, {\\\"CPRPRI_0\\\", \\\"Precio Coste\\\"}, {\\\"DISCRGVAL1_0\\\", \\\"Valor Descuento 1\\\"}, {\\\"DISCRGVAL2_0\\\", \\\"Valor Descuento 2\\\"}, {\\\"DISCRGREN1_0\\\", \\\"Motivo Descuento\\\"}, {\\\"DISCRGREN2_0\\\", \\\"Motivo Descuento 2\\\"}, {\\\"AMTNOTLIN_0\\\", \\\"Total Linea Sin Impuesto\\\"}, {\\\"BASTAXLIN_0\\\", \\\"Importe Imponible\\\"}, {\\\"RATTAXLIN_0\\\", \\\"Tasa Impuesto\\\"}, {\\\"AMTTAXLIN_0\\\", \\\"Importe Impuesto\\\"}, {\\\"AMTATILIN_0\\\", \\\"Total Linea con Impuesto\\\"}, {\\\"QTY_0\\\", \\\"Cantidad\\\"}, {\\\"SAU_0\\\", \\\"Unidad Venta\\\"}, {\\\"PRIORD_0\\\", \\\"Precio Pedido\\\"}, {\\\"ACCDAT_0\\\", \\\"Fecha Factura\\\"}, {\\\"VAT_0\\\", \\\"Tipo IVA\\\"},{\\\"SNS_0\\\", \\\"Sentido Cargo/Abono\\\"}, {\\\"ORIMOD_0\\\", \\\"Modulo\\\"},{\\\"QTYSTU_0\\\", \\\"Quantity\\\"},{\\\"BPAADD_0\\\", \\\"Direccion de envio\\\"}}),\\n    #\\\"Tipo cambiado\\\" = Table.TransformColumnTypes(#\\\"Columnas con nombre cambiado\\\",{{\\\"Fecha Factura\\\", type date}})\\nin\\n    #\\\"Tipo cambiado\\\"\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Exception",
      "isHidden": false
    },
    {
      "name": "Sales Invoice Header",
      "lineageTag": "2c2adf06-bfe9-4db6-863b-539ade518b35",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    CurrentRows = Registros,",
        "    CurrentPeriod = Periodo,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "",
        "DECLARE @ANO1 VARCHAR(20)",
        "DECLARE @ANO2 int",
        "set @ANO1='\"& CurrentPeriod &\"'",
        "set @ANO2=(SELECT MIN(PERIODO) FROM (\tSELECT YEAR(ACCDAT_0) AS PERIODO,COUNT(*) AS REGISTROS,",
        "\t\t\t\t\t\t\t\t\t\tSUM(COUNT(*)) OVER (ORDER BY YEAR(ACCDAT_0) DESC) AS ACUMULADO",
        "\t\t\t\t\t\t\t\t\t\tFROM \" & CurrentSchema &\".SINVOICED as SED left join \" & CurrentSchema &\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0",
        "\t\t\t\t\t\t\t\t\t\twhere SE.ORIMOD_0=5 and INVTYP_0 <>5 ",
        "\t\t\t\t\t\t\t\t\t\tGROUP BY YEAR(ACCDAT_0)",
        "\t\t\t\t\t\t\t\t\t\t) A\tWHERE ACUMULADO <=\" & CurrentRows &\")",
        "\t\t\t\t\t\t\t\t\t\t",
        "",
        "IF @ANO1='Periodo automático'",
        "",
        "(",
        "            SELECT",
        "            [NUM_0],",
        "            [CPY_0],",
        "            [FCY_0]",
        "            ,[BPR_0]",
        "            ,[SIVTYP_0]     ",
        "            ,[ACCDAT_0]",
        "            ,[CUR_0]",
        "            ,[DEP_0]",
        "            ,[DEPRAT_0]",
        "            ,[STA_0]",
        "            ,[VAC_0]",
        "            ,[ORIMOD_0]",
        "            FROM \" & CurrentSchema & \".SINVOICE",
        "            WHERE [ORIMOD_0] = 5  and INVTYP_0 in (1,2) AND YEAR(ACCDAT_0)>=@ANO2",
        "",
        ")",
        "",
        "            ELSE",
        "",
        "(",
        "            SELECT",
        "            [NUM_0],",
        "            [CPY_0],",
        "            [FCY_0]",
        "            ,[BPR_0]",
        "            ,[SIVTYP_0]     ",
        "            ,[ACCDAT_0]",
        "            ,[CUR_0]",
        "            ,[DEP_0]",
        "            ,[DEPRAT_0]",
        "            ,[STA_0]",
        "            ,[VAC_0]",
        "            ,[ORIMOD_0]",
        "            FROM \" & CurrentSchema & \".SINVOICE",
        "            WHERE [ORIMOD_0] = 5  and INVTYP_0 in (1,2) AND YEAR(ACCDAT_0)>=@ANO1",
        " )",
        "",
        "    \"",
        "]),",
        "",
        "    #\"Columnas con nombre cambiado\" = Table.RenameColumns(Origen,{{\"NUM_0\", \"Documento\"}, {\"CPY_0\", \"Empresa\"}, {\"FCY_0\", \"Planta Venta\"}, {\"BPR_0\", \"IdCliente\"}, {\"SIVTYP_0\", \"Tipo Factura\"}, {\"ACCDAT_0\", \"Fecha Factura\"}, {\"CUR_0\", \"Moneda\"}, {\"DEP_0\", \"Descuento\"}, {\"DEPRAT_0\", \"Ratio Descuento\"}, {\"STA_0\", \"Validacion\"}, {\"VAC_0\", \"Regimen Tercero\"}, {\"ORIMOD_0\", \"Modulo\"}}),",
        "    #\"Filtered Rows\" = Table.SelectRows(#\"Columnas con nombre cambiado\", each true)",
        "in",
        "    #\"Filtered Rows\""
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    CurrentServer = Instancia,\\n    CurrentDatabase = BaseDeDatos,\\n    CurrentSchema = Esquema,\\n    CurrentRows = Registros,\\n    CurrentPeriod = Periodo,\\n    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\\\"\\n\\nDECLARE @ANO1 VARCHAR(20)\\nDECLARE @ANO2 int\\nset @ANO1='\\\"& CurrentPeriod &\\\"'\\nset @ANO2=(SELECT MIN(PERIODO) FROM (\\tSELECT YEAR(ACCDAT_0) AS PERIODO,COUNT(*) AS REGISTROS,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tSUM(COUNT(*)) OVER (ORDER BY YEAR(ACCDAT_0) DESC) AS ACUMULADO\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tFROM \\\" & CurrentSchema &\\\".SINVOICED as SED left join \\\" & CurrentSchema &\\\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\twhere SE.ORIMOD_0=5 and INVTYP_0 <>5 \\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tGROUP BY YEAR(ACCDAT_0)\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t) A\\tWHERE ACUMULADO <=\\\" & CurrentRows &\\\")\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\n\\nIF @ANO1='Periodo automático'\\n\\n(\\n            SELECT\\n            [NUM_0],\\n            [CPY_0],\\n            [FCY_0]\\n            ,[BPR_0]\\n            ,[SIVTYP_0]     \\n            ,[ACCDAT_0]\\n            ,[CUR_0]\\n            ,[DEP_0]\\n            ,[DEPRAT_0]\\n            ,[STA_0]\\n            ,[VAC_0]\\n            ,[ORIMOD_0]\\n            FROM \\\" & CurrentSchema & \\\".SINVOICE\\n            WHERE [ORIMOD_0] = 5  and INVTYP_0 in (1,2) AND YEAR(ACCDAT_0)>=@ANO2\\n\\n)\\n\\n            ELSE\\n\\n(\\n            SELECT\\n            [NUM_0],\\n            [CPY_0],\\n            [FCY_0]\\n            ,[BPR_0]\\n            ,[SIVTYP_0]     \\n            ,[ACCDAT_0]\\n            ,[CUR_0]\\n            ,[DEP_0]\\n            ,[DEPRAT_0]\\n            ,[STA_0]\\n            ,[VAC_0]\\n            ,[ORIMOD_0]\\n            FROM \\\" & CurrentSchema & \\\".SINVOICE\\n            WHERE [ORIMOD_0] = 5  and INVTYP_0 in (1,2) AND YEAR(ACCDAT_0)>=@ANO1\\n )\\n\\n    \\\"\\n]),\\n\\n    #\\\"Columnas con nombre cambiado\\\" = Table.RenameColumns(Origen,{{\\\"NUM_0\\\", \\\"Documento\\\"}, {\\\"CPY_0\\\", \\\"Empresa\\\"}, {\\\"FCY_0\\\", \\\"Planta Venta\\\"}, {\\\"BPR_0\\\", \\\"IdCliente\\\"}, {\\\"SIVTYP_0\\\", \\\"Tipo Factura\\\"}, {\\\"ACCDAT_0\\\", \\\"Fecha Factura\\\"}, {\\\"CUR_0\\\", \\\"Moneda\\\"}, {\\\"DEP_0\\\", \\\"Descuento\\\"}, {\\\"DEPRAT_0\\\", \\\"Ratio Descuento\\\"}, {\\\"STA_0\\\", \\\"Validacion\\\"}, {\\\"VAC_0\\\", \\\"Regimen Tercero\\\"}, {\\\"ORIMOD_0\\\", \\\"Modulo\\\"}}),\\n    #\\\"Filtered Rows\\\" = Table.SelectRows(#\\\"Columnas con nombre cambiado\\\", each true)\\nin\\n    #\\\"Filtered Rows\\\"\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Customer",
      "lineageTag": "87a08bef-d5ce-488c-843d-139538bde7f0",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "                                                                SELECT  ",
        "                                                                     c.[BPCNUM_0]",
        "                                                                    ,c.[BPCNAM_0]",
        "                                                                    ,c.[BCGCOD_0]",
        "                                                                    ,c.[GRP_0]",
        "                                                                    ,c.[BPCTYP_0]",
        "                                                                    ,c.[BPAINV_0]",
        "                                                                    ,c.[CUR_0]",
        "                                                                    ,a.CRY_0",
        "                                                                    ,a.CTY_0",
        "                                                                FROM \" & CurrentSchema & \".BPCUSTOMER as c",
        "                                                                LEFT JOIN \" & CurrentSchema & \".BPADDRESS as a",
        "                                                                on c.BPCNUM_0 = a.BPANUM_0 and c.BPAINV_0 = a.BPAADD_0 and c.BPCTYP_0 = a.BPATYP_0\" ",
        "                                                          ]),",
        "    #\"Columnas con nombre cambiado\" = Table.RenameColumns(Origen,{{\"BPCNUM_0\", \"IdCliente\"}, {\"BPCNAM_0\", \"Cliente\"}, {\"BCGCOD_0\", \"Categoria\"}, {\"GRP_0\", \"Grupo\"}, {\"BPCTYP_0\", \"Tipo\"}, {\"BPAINV_0\", \"Direccion\"}, {\"CUR_0\", \"Moneda\"}, {\"CRY_0\", \"Pais\"}, {\"CTY_0\", \"Ciudad\"}}),",
        "    #\"Personalizada agregada\" = Table.AddColumn(#\"Columnas con nombre cambiado\", \"IdDireccion\", each [IdCliente] & \"-\" & [Direccion])",
        "in",
        "    #\"Personalizada agregada\""
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    CurrentServer = Instancia,\\n    CurrentDatabase = BaseDeDatos,\\n    CurrentSchema = Esquema,\\n    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\\\"\\n                                                                SELECT  \\n                                                                     c.[BPCNUM_0]\\n                                                                    ,c.[BPCNAM_0]\\n                                                                    ,c.[BCGCOD_0]\\n                                                                    ,c.[GRP_0]\\n                                                                    ,c.[BPCTYP_0]\\n                                                                    ,c.[BPAINV_0]\\n                                                                    ,c.[CUR_0]\\n                                                                    ,a.CRY_0\\n                                                                    ,a.CTY_0\\n                                                                FROM \\\" & CurrentSchema & \\\".BPCUSTOMER as c\\n                                                                LEFT JOIN \\\" & CurrentSchema & \\\".BPADDRESS as a\\n                                                                on c.BPCNUM_0 = a.BPANUM_0 and c.BPAINV_0 = a.BPAADD_0 and c.BPCTYP_0 = a.BPATYP_0\\\" \\n                                                          ]),\\n    #\\\"Columnas con nombre cambiado\\\" = Table.RenameColumns(Origen,{{\\\"BPCNUM_0\\\", \\\"IdCliente\\\"}, {\\\"BPCNAM_0\\\", \\\"Cliente\\\"}, {\\\"BCGCOD_0\\\", \\\"Categoria\\\"}, {\\\"GRP_0\\\", \\\"Grupo\\\"}, {\\\"BPCTYP_0\\\", \\\"Tipo\\\"}, {\\\"BPAINV_0\\\", \\\"Direccion\\\"}, {\\\"CUR_0\\\", \\\"Moneda\\\"}, {\\\"CRY_0\\\", \\\"Pais\\\"}, {\\\"CTY_0\\\", \\\"Ciudad\\\"}}),\\n    #\\\"Personalizada agregada\\\" = Table.AddColumn(#\\\"Columnas con nombre cambiado\\\", \\\"IdDireccion\\\", each [IdCliente] & \\\"-\\\" & [Direccion])\\nin\\n    #\\\"Personalizada agregada\\\"\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Address",
      "lineageTag": "a23f9ee2-22f9-4a22-b324-421fca5adb94",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "                                                                SELECT  ",
        "          [BPATYP_0]",
        "         ,[BPANUM_0]",
        "         ,[BPAADD_0]",
        "         ,[BPADES_0]",
        "         ,[BPAADDLIG_0]",
        "         ,[BPAADDLIG_1]",
        "         ,[BPAADDLIG_2]",
        "         ,[POSCOD_0]",
        "         ,[CTY_0]",
        "         ,[SAT_0]",
        "         ,ADR.[CRY_0]",
        "         ,[CRYNAM_0]",
        "         ,[TEL_0]",
        "         ,[TEL_1]",
        "         ,[TEL_2]",
        "         ,[TEL_3]",
        "         ,[TEL_4]",
        "         ,[FAX_0]",
        "         ,[MOB_0]",
        "         ,[WEB_0]",
        "         ,[WEB_1]",
        "         ,[WEB_2]",
        "         ,[WEB_3]",
        "         ,[WEB_4]",
        "         ,[FCYWEB_0]",
        "\t\t ,AXX.TEXTE_0",
        " FROM \" & CurrentSchema & \".BPADDRESS ADR ",
        " left join \" & CurrentSchema & \".TABSUBDIV TSD on TSD.CRY_0=ADR.CRY_0 and ADR.SAT_0=TSD.COD_0 and TSD.TYP_0 = 3",
        " left join \" & CurrentSchema & \".ATEXTRA AXX on (AXX.CODFIC_0 = 'TABSUBDIV' and AXX.ZONE_0 = 'INTIT' and AXX.LANGUE_0 = 'SPA' and AXX.IDENT1_0 = TSD.CRYTYP_0 and AXX.IDENT2_0 = TSD.COD_0)\"",
        "                                                          ]),",
        "    #\"Columnas con nombre cambiado\" = Table.RenameColumns(Origen,{{\"BPATYP_0\", \"Tipo Entidad\"}, {\"BPANUM_0\", \"Entidad\"}, {\"BPAADD_0\", \"Direccion\"}, {\"BPADES_0\", \"Descripcion\"}, {\"BPAADDLIG_0\", \"Linea Direcion\"}, {\"BPAADDLIG_1\", \"Linea Direcion 1\"}, {\"BPAADDLIG_2\", \"Linea Direcion 2\"}, {\"POSCOD_0\", \"Codigo Postal\"}, {\"CTY_0\", \"Ciudad\"}, {\"SAT_0\", \"Provincia\"}, {\"CRY_0\", \"Pais\"}, {\"CRYNAM_0\", \"Nombre Pais\"}, {\"TEL_0\", \"Telefono 1\"}, {\"TEL_1\", \"Telefono 2\"}, {\"TEL_2\", \"Telefono 3\"}, {\"TEL_3\", \"Telefono 4\"}, {\"TEL_4\", \"Telefono 5\"}, {\"FAX_0\", \"Fax\"}, {\"MOB_0\", \"Movil\"}, {\"WEB_0\", \"Correo 1\"}, {\"WEB_1\", \"Correo 2\"}, {\"WEB_2\", \"Correo 3\"}, {\"WEB_3\", \"Correo 4\"}, {\"WEB_4\", \"Correo 5\"}, {\"FCYWEB_0\", \"Sitio Web\"},{\"TEXTE_0\", \"Provincia Nombre\"}}),",
        "    #\"Personalizada agregada\" = Table.AddColumn(#\"Columnas con nombre cambiado\", \"IdDireccion\", each [Entidad]&\"-\"&[Direccion]),",
        "    #\"Columnas reordenadas\" = Table.ReorderColumns(#\"Personalizada agregada\",{\"IdDireccion\", \"Tipo Entidad\", \"Entidad\", \"Direccion\", \"Descripcion\", \"Linea Direcion\", \"Linea Direcion 1\", \"Linea Direcion 2\", \"Codigo Postal\", \"Ciudad\", \"Provincia\", \"Pais\", \"Nombre Pais\", \"Telefono 1\", \"Telefono 2\", \"Telefono 3\", \"Telefono 4\", \"Telefono 5\", \"Fax\", \"Movil\", \"Correo 1\", \"Correo 2\", \"Correo 3\", \"Correo 4\", \"Correo 5\", \"Sitio Web\"}),",
        "    #\"Renamed Columns\" = Table.RenameColumns(#\"Columnas reordenadas\",{{\"Nombre Pais\", \"País\"}}),",
        "    #\"Merged Queries\" = Table.FuzzyNestedJoin(#\"Renamed Columns\", {\"Provincia\"}, Provincias, {\"Provincias\"}, \"Provincias\", JoinKind.LeftOuter, [IgnoreCase=true, IgnoreSpace=true, Threshold=0.6]),",
        "    #\"Expanded Provincias\" = Table.ExpandTableColumn(#\"Merged Queries\", \"Provincias\", {\"Provincias\"}, {\"Provincias.Provincias\"}),",
        "    #\"Uppercased Text\" = Table.TransformColumns(#\"Expanded Provincias\",{{\"Provincia\", Text.Upper, type text}, {\"Ciudad\", Text.Upper, type text}}),",
        "    #\"Valor Cordoba\" = Table.ReplaceValue(#\"Uppercased Text\",\"Córdoba\",\"Córdoba, Andalucia\",Replacer.ReplaceText,{\"Provincia Nombre\"}),",
        "    #\"Valor reemplazado\" = Table.ReplaceValue(#\"Valor Cordoba\",\"Granada\",\"Granada, Andalucia\",Replacer.ReplaceText,{\"Provincia Nombre\"}),",
        "    #\"Valor Zaragoza\" = Table.ReplaceValue(#\"Valor reemplazado\",\"Zaragoza\",\"Zaragoza, Aragón\",Replacer.ReplaceText,{\"Provincia Nombre\"}),",
        "    #\"Valor Toledo\" = Table.ReplaceValue(#\"Valor Zaragoza\",\"Toledo\",\"Toledo, Castilla-La Mancha\",Replacer.ReplaceText,{\"Provincia Nombre\"}),",
        "    #\"Valor Las Palmas\" = Table.ReplaceValue(#\"Valor Toledo\",\"Palmas, Las\",\"Las Palmas\",Replacer.ReplaceText,{\"Provincia Nombre\"}),",
        "    #\"Valor La Rioja\" = Table.ReplaceValue(#\"Valor Las Palmas\",\"Rioja, La\",\"La Rioja\",Replacer.ReplaceText,{\"Provincia Nombre\"})",
        "in",
        "    #\"Valor La Rioja\""
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    CurrentServer = Instancia,\\n    CurrentDatabase = BaseDeDatos,\\n    CurrentSchema = Esquema,\\n    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\\\"\\n                                                                SELECT  \\n          [BPATYP_0]\\n         ,[BPANUM_0]\\n         ,[BPAADD_0]\\n         ,[BPADES_0]\\n         ,[BPAADDLIG_0]\\n         ,[BPAADDLIG_1]\\n         ,[BPAADDLIG_2]\\n         ,[POSCOD_0]\\n         ,[CTY_0]\\n         ,[SAT_0]\\n         ,ADR.[CRY_0]\\n         ,[CRYNAM_0]\\n         ,[TEL_0]\\n         ,[TEL_1]\\n         ,[TEL_2]\\n         ,[TEL_3]\\n         ,[TEL_4]\\n         ,[FAX_0]\\n         ,[MOB_0]\\n         ,[WEB_0]\\n         ,[WEB_1]\\n         ,[WEB_2]\\n         ,[WEB_3]\\n         ,[WEB_4]\\n         ,[FCYWEB_0]\\n\\t\\t ,AXX.TEXTE_0\\n FROM \\\" & CurrentSchema & \\\".BPADDRESS ADR \\n left join \\\" & CurrentSchema & \\\".TABSUBDIV TSD on TSD.CRY_0=ADR.CRY_0 and ADR.SAT_0=TSD.COD_0 and TSD.TYP_0 = 3\\n left join \\\" & CurrentSchema & \\\".ATEXTRA AXX on (AXX.CODFIC_0 = 'TABSUBDIV' and AXX.ZONE_0 = 'INTIT' and AXX.LANGUE_0 = 'SPA' and AXX.IDENT1_0 = TSD.CRYTYP_0 and AXX.IDENT2_0 = TSD.COD_0)\\\"\\n                                                          ]),\\n    #\\\"Columnas con nombre cambiado\\\" = Table.RenameColumns(Origen,{{\\\"BPATYP_0\\\", \\\"Tipo Entidad\\\"}, {\\\"BPANUM_0\\\", \\\"Entidad\\\"}, {\\\"BPAADD_0\\\", \\\"Direccion\\\"}, {\\\"BPADES_0\\\", \\\"Descripcion\\\"}, {\\\"BPAADDLIG_0\\\", \\\"Linea Direcion\\\"}, {\\\"BPAADDLIG_1\\\", \\\"Linea Direcion 1\\\"}, {\\\"BPAADDLIG_2\\\", \\\"Linea Direcion 2\\\"}, {\\\"POSCOD_0\\\", \\\"Codigo Postal\\\"}, {\\\"CTY_0\\\", \\\"Ciudad\\\"}, {\\\"SAT_0\\\", \\\"Provincia\\\"}, {\\\"CRY_0\\\", \\\"Pais\\\"}, {\\\"CRYNAM_0\\\", \\\"Nombre Pais\\\"}, {\\\"TEL_0\\\", \\\"Telefono 1\\\"}, {\\\"TEL_1\\\", \\\"Telefono 2\\\"}, {\\\"TEL_2\\\", \\\"Telefono 3\\\"}, {\\\"TEL_3\\\", \\\"Telefono 4\\\"}, {\\\"TEL_4\\\", \\\"Telefono 5\\\"}, {\\\"FAX_0\\\", \\\"Fax\\\"}, {\\\"MOB_0\\\", \\\"Movil\\\"}, {\\\"WEB_0\\\", \\\"Correo 1\\\"}, {\\\"WEB_1\\\", \\\"Correo 2\\\"}, {\\\"WEB_2\\\", \\\"Correo 3\\\"}, {\\\"WEB_3\\\", \\\"Correo 4\\\"}, {\\\"WEB_4\\\", \\\"Correo 5\\\"}, {\\\"FCYWEB_0\\\", \\\"Sitio Web\\\"},{\\\"TEXTE_0\\\", \\\"Provincia Nombre\\\"}}),\\n    #\\\"Personalizada agregada\\\" = Table.AddColumn(#\\\"Columnas con nombre cambiado\\\", \\\"IdDireccion\\\", each [Entidad]&\\\"-\\\"&[Direccion]),\\n    #\\\"Columnas reordenadas\\\" = Table.ReorderColumns(#\\\"Personalizada agregada\\\",{\\\"IdDireccion\\\", \\\"Tipo Entidad\\\", \\\"Entidad\\\", \\\"Direccion\\\", \\\"Descripcion\\\", \\\"Linea Direcion\\\", \\\"Linea Direcion 1\\\", \\\"Linea Direcion 2\\\", \\\"Codigo Postal\\\", \\\"Ciudad\\\", \\\"Provincia\\\", \\\"Pais\\\", \\\"Nombre Pais\\\", \\\"Telefono 1\\\", \\\"Telefono 2\\\", \\\"Telefono 3\\\", \\\"Telefono 4\\\", \\\"Telefono 5\\\", \\\"Fax\\\", \\\"Movil\\\", \\\"Correo 1\\\", \\\"Correo 2\\\", \\\"Correo 3\\\", \\\"Correo 4\\\", \\\"Correo 5\\\", \\\"Sitio Web\\\"}),\\n    #\\\"Renamed Columns\\\" = Table.RenameColumns(#\\\"Columnas reordenadas\\\",{{\\\"Nombre Pais\\\", \\\"País\\\"}}),\\n    #\\\"Merged Queries\\\" = Table.FuzzyNestedJoin(#\\\"Renamed Columns\\\", {\\\"Provincia\\\"}, Provincias, {\\\"Provincias\\\"}, \\\"Provincias\\\", JoinKind.LeftOuter, [IgnoreCase=true, IgnoreSpace=true, Threshold=0.6]),\\n    #\\\"Expanded Provincias\\\" = Table.ExpandTableColumn(#\\\"Merged Queries\\\", \\\"Provincias\\\", {\\\"Provincias\\\"}, {\\\"Provincias.Provincias\\\"}),\\n    #\\\"Uppercased Text\\\" = Table.TransformColumns(#\\\"Expanded Provincias\\\",{{\\\"Provincia\\\", Text.Upper, type text}, {\\\"Ciudad\\\", Text.Upper, type text}}),\\n    #\\\"Valor Cordoba\\\" = Table.ReplaceValue(#\\\"Uppercased Text\\\",\\\"Córdoba\\\",\\\"Córdoba, Andalucia\\\",Replacer.ReplaceText,{\\\"Provincia Nombre\\\"}),\\n    #\\\"Valor reemplazado\\\" = Table.ReplaceValue(#\\\"Valor Cordoba\\\",\\\"Granada\\\",\\\"Granada, Andalucia\\\",Replacer.ReplaceText,{\\\"Provincia Nombre\\\"}),\\n    #\\\"Valor Zaragoza\\\" = Table.ReplaceValue(#\\\"Valor reemplazado\\\",\\\"Zaragoza\\\",\\\"Zaragoza, Aragón\\\",Replacer.ReplaceText,{\\\"Provincia Nombre\\\"}),\\n    #\\\"Valor Toledo\\\" = Table.ReplaceValue(#\\\"Valor Zaragoza\\\",\\\"Toledo\\\",\\\"Toledo, Castilla-La Mancha\\\",Replacer.ReplaceText,{\\\"Provincia Nombre\\\"}),\\n    #\\\"Valor Las Palmas\\\" = Table.ReplaceValue(#\\\"Valor Toledo\\\",\\\"Palmas, Las\\\",\\\"Las Palmas\\\",Replacer.ReplaceText,{\\\"Provincia Nombre\\\"}),\\n    #\\\"Valor La Rioja\\\" = Table.ReplaceValue(#\\\"Valor Las Palmas\\\",\\\"Rioja, La\\\",\\\"La Rioja\\\",Replacer.ReplaceText,{\\\"Provincia Nombre\\\"})\\nin\\n    #\\\"Valor La Rioja\\\"\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Company",
      "lineageTag": "008568a0-5739-43d3-909e-27205a3c0d29",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "                                                                SELECT  ",
        "                                                                     [CPY_0]",
        "                                                                    ,[CPYNAM_0]",
        "                                                                    ,[BPAADD_0]",
        "                                                                    ,[CPYLEGFLG_0]",
        "                                                                    ,[LEG_0]",
        "                                                                    ,[ACM_0]",
        "                                                                    ,[MAIFCY_0]",
        "                                                                    ,[CRY_0]   ",
        "                                                                FROM \" & CurrentSchema & \".COMPANY\"",
        "                                                          ]),",
        "    #\"Columnas con nombre cambiado\" = Table.RenameColumns(Origen,{{\"CPY_0\", \"Empresa\"}, {\"CPYNAM_0\", \"Nombre Empresa\"}, {\"CPYLEGFLG_0\", \"Sociedad Juridica\"}, {\"LEG_0\", \"Legislacion\"}, {\"ACM_0\", \"Modelo Contable\"}, {\"MAIFCY_0\", \"Planta Principal\"}, {\"CRY_0\", \"Pais\"}, {\"BPAADD_0\", \"Direccion\"}}),",
        "    #\"Personalizada agregada\" = Table.AddColumn(#\"Columnas con nombre cambiado\", \"IdDireccion\", each [Empresa]&\"-\"&[Direccion]),",
        "    #\"Columnas reordenadas\" = Table.ReorderColumns(#\"Personalizada agregada\",{\"IdDireccion\", \"Empresa\", \"Nombre Empresa\", \"Direccion\", \"Sociedad Juridica\", \"Legislacion\", \"Modelo Contable\", \"Planta Principal\", \"Pais\"})",
        "in",
        "    #\"Columnas reordenadas\""
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    CurrentServer = Instancia,\\n    CurrentDatabase = BaseDeDatos,\\n    CurrentSchema = Esquema,\\n    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\\\"\\n                                                                SELECT  \\n                                                                     [CPY_0]\\n                                                                    ,[CPYNAM_0]\\n                                                                    ,[BPAADD_0]\\n                                                                    ,[CPYLEGFLG_0]\\n                                                                    ,[LEG_0]\\n                                                                    ,[ACM_0]\\n                                                                    ,[MAIFCY_0]\\n                                                                    ,[CRY_0]   \\n                                                                FROM \\\" & CurrentSchema & \\\".COMPANY\\\"\\n                                                          ]),\\n    #\\\"Columnas con nombre cambiado\\\" = Table.RenameColumns(Origen,{{\\\"CPY_0\\\", \\\"Empresa\\\"}, {\\\"CPYNAM_0\\\", \\\"Nombre Empresa\\\"}, {\\\"CPYLEGFLG_0\\\", \\\"Sociedad Juridica\\\"}, {\\\"LEG_0\\\", \\\"Legislacion\\\"}, {\\\"ACM_0\\\", \\\"Modelo Contable\\\"}, {\\\"MAIFCY_0\\\", \\\"Planta Principal\\\"}, {\\\"CRY_0\\\", \\\"Pais\\\"}, {\\\"BPAADD_0\\\", \\\"Direccion\\\"}}),\\n    #\\\"Personalizada agregada\\\" = Table.AddColumn(#\\\"Columnas con nombre cambiado\\\", \\\"IdDireccion\\\", each [Empresa]&\\\"-\\\"&[Direccion]),\\n    #\\\"Columnas reordenadas\\\" = Table.ReorderColumns(#\\\"Personalizada agregada\\\",{\\\"IdDireccion\\\", \\\"Empresa\\\", \\\"Nombre Empresa\\\", \\\"Direccion\\\", \\\"Sociedad Juridica\\\", \\\"Legislacion\\\", \\\"Modelo Contable\\\", \\\"Planta Principal\\\", \\\"Pais\\\"})\\nin\\n    #\\\"Columnas reordenadas\\\"\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Saleperson",
      "lineageTag": "9e54ec5a-7c17-4b59-a1d0-d0d9e0788d20",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "                                                                SELECT   [REPNUM_0]",
        "                                                                        ,[REPNAM_0]",
        "                                                                        ,[AUSNUM_0]",
        "                                                                        ,[CFY_0]",
        "                                                                        ,[CUR_0]",
        "                                                                        ,[BPAADD_0]",
        "                                                                FROM \" & CurrentSchema & \".SALESREP\"",
        "                                                          ]),",
        "    #\"Columnas con nombre cambiado\" = Table.RenameColumns(Origen,{{\"REPNUM_0\", \"Comercial\"}, {\"REPNAM_0\", \"Nombre Comercial\"}, {\"AUSNUM_0\", \"Codigo Usuario\"}, {\"CFY_0\", \"Empresa\"}, {\"CUR_0\", \"Moneda\"}, {\"BPAADD_0\", \"Direccion\"}}),",
        "    #\"Personalizada agregada\" = Table.AddColumn(#\"Columnas con nombre cambiado\", \"IdDireccion\", each [Comercial]&\"-\"&[Direccion])",
        "in",
        "    #\"Personalizada agregada\""
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    CurrentServer = Instancia,\\n    CurrentDatabase = BaseDeDatos,\\n    CurrentSchema = Esquema,\\n    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\\\"\\n                                                                SELECT   [REPNUM_0]\\n                                                                        ,[REPNAM_0]\\n                                                                        ,[AUSNUM_0]\\n                                                                        ,[CFY_0]\\n                                                                        ,[CUR_0]\\n                                                                        ,[BPAADD_0]\\n                                                                FROM \\\" & CurrentSchema & \\\".SALESREP\\\"\\n                                                          ]),\\n    #\\\"Columnas con nombre cambiado\\\" = Table.RenameColumns(Origen,{{\\\"REPNUM_0\\\", \\\"Comercial\\\"}, {\\\"REPNAM_0\\\", \\\"Nombre Comercial\\\"}, {\\\"AUSNUM_0\\\", \\\"Codigo Usuario\\\"}, {\\\"CFY_0\\\", \\\"Empresa\\\"}, {\\\"CUR_0\\\", \\\"Moneda\\\"}, {\\\"BPAADD_0\\\", \\\"Direccion\\\"}}),\\n    #\\\"Personalizada agregada\\\" = Table.AddColumn(#\\\"Columnas con nombre cambiado\\\", \\\"IdDireccion\\\", each [Comercial]&\\\"-\\\"&[Direccion])\\nin\\n    #\\\"Personalizada agregada\\\"\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Item",
      "lineageTag": "8099d0dd-b23d-43ec-b6cc-fa03fb491aaa",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    CurrentCompany = Empresa,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "                                                                SELECT   ITM.[ITMREF_0] AS IdItem",
        "                                                                        ,ITM.[CPY_0] AS Sociedad",
        "                                                                        ,ITM.[TCLCOD_0] AS IdCategoria",
        "                                                                        ,TXCAT.TEXTE_0 AS CATEGORIA",
        "                                                                        ,ITM.[ACCCOD_0] AS 'Codigo Contable'",
        "                                                                        ,ITM.[ITMDES1_0] AS 'Descripcion 1'",
        "                                                                        ,ITM.[ITMDES2_0] AS 'Descripcion 2'",
        "                                                                        ,ITM.[ITMDES3_0] AS 'Descripcion 3'",
        "                                                                        ,ITM.[STU_0] AS Unidad",
        "                                                                        ,ITM.[VACITM_0] AS 'Nivel Impuesto'",
        "                                                                        ,ITM.[BUY_0] AS Comprador",
        "                                                                        ,ITM.[PURBASPRI_0] AS 'Precio Base'",
        "                                                                        ,ITM.[CPRCOE_0] AS 'Coef Gastos Entrega'",
        "                                                                        ,ITM.[CPRAMT_0] AS 'Coste Fijo Unitario'",
        "                                                                        ,ITM.[CCE_0] AS 'Eje Analitico 1'",
        "                                                                        ,ITM.[CCE_1] AS 'Eje Analitico 2'",
        "                                                                        ,ITM.[CCE_2] AS 'Eje Analitico 3'",
        "                                                                        ,ITM.[CCE_3] AS 'Eje Analitico 4'",
        "                                                                        ,ITM.TSICOD_0 AS 'Codigo Famlia Analisis'",
        "                                                                        ,ITM.TSICOD_1 AS 'Codigo Subfamilia Analisis'",
        "                                                                        ,TXT.TEXTE_0 AS Familia",
        "                                                                        ,TXT2.TEXTE_0 AS Subfamilia",
        "                                                                        ,ITMS.[MINQTY_0] AS 'Cantidad Minima'",
        "                                                                        ,ITMS.[MAXQTY_0] AS 'Cantidad Máxima'",
        "                                                                        ,ITMS.[MINPFM_0] AS 'Margen Minimo'",
        "                                                                        ,ITMS.[MINPRI_0] AS 'Precio Minimo'",
        "                                                                        ,ITMS.[THEPRI_0] AS 'Precio Teorico'",
        "                                                                        ,ITMS.[BASPRI_0] AS 'Precio Base Ventas'",
        "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,(select top 1 ITS.BPSNUM_0 from \" & CurrentSchema & \".ITMBPS ITS where ITS.ITMREF_0 = ITM.ITMREF_0 and ITS.PIO_0 = 0) as Supplier",
        "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,(select top 1 ITS.ITMREFBPS_0 from \" & CurrentSchema & \".ITMBPS ITS where ITS.ITMREF_0 = ITM.ITMREF_0 and ITS.BPSNUM_0='\" & CurrentCompany &\"') as [Vygon Item Number]",
        "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,case when BPS.ITMREF_0 is null then 'N' else 'Y' end as 'Purchased from VYGON'",
        "                                                                    FROM \" & CurrentSchema & \".ITMMASTER AS ITM",
        "                                                                    LEFT JOIN \" & CurrentSchema & \".[ITMSALES] AS ITMS",
        "                                                                    ON ITM.ITMREF_0 = ITMS.ITMREF_0",
        "                                                                    LEFT JOIN \" & CurrentSchema & \".ATEXTRA as TXT",
        "                                                                    on ITM.TSICOD_0 = TXT.IDENT2_0  AND CODFIC_0 = 'ATABDIV' AND ZONE_0 = 'LNGDES' AND IDENT1_0 = '20' AND LANGUE_0 = 'SPA'",
        "                                                                    LEFT JOIN \" & CurrentSchema & \".ATEXTRA as TXT2",
        "                                                                    on ITM.TSICOD_1 = TXT2.IDENT2_0 AND TXT2.CODFIC_0 = 'ATABDIV' AND TXT2.ZONE_0 = 'LNGDES' AND TXT2.IDENT1_0 = '21' AND TXT2.LANGUE_0 = 'SPA'",
        "                                                                    LEFT JOIN \" & CurrentSchema & \".ATEXTRA AS TXCAT",
        "                                                                    ON ITM.TCLCOD_0 = TXCAT.IDENT1_0 AND TXCAT.CODFIC_0 = 'ITMCATEG' AND TXCAT.ZONE_0 = 'TCLAXX' AND TXCAT.LANGUE_0 = 'SPA'",
        "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tLEFT JOIN  PROTO.ITMBPS BPS on ITM.ITMREF_0=BPS.ITMREF_0  and BPS.BPSNUM_0='\" & CurrentCompany &\"'\"",
        "                                                          ]),",
        "    #\"Added Custom\" = Table.AddColumn(Origen, \"Subsidiary ID\", each \"ES\"),",
        "    #\"Added Custom1\" = Table.AddColumn(#\"Added Custom\", \"EOR\", each \"EOR\"),",
        "    #\"Renamed Columns\" = Table.RenameColumns(#\"Added Custom1\",{{\"Familia\", \"Business Unit\"}, {\"Codigo Famlia Analisis\", \"Codigo Business Unit Analisis\"}, {\"Codigo Subfamilia Analisis\", \"Codigo Familia Analisis\"}, {\"Subfamilia\", \"Familia\"}})",
        "in",
        "    #\"Renamed Columns\""
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    CurrentServer = Instancia,\\n    CurrentDatabase = BaseDeDatos,\\n    CurrentSchema = Esquema,\\n    CurrentCompany = Empresa,\\n    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\\\"\\n                                                                SELECT   ITM.[ITMREF_0] AS IdItem\\n                                                                        ,ITM.[CPY_0] AS Sociedad\\n                                                                        ,ITM.[TCLCOD_0] AS IdCategoria\\n                                                                        ,TXCAT.TEXTE_0 AS CATEGORIA\\n                                                                        ,ITM.[ACCCOD_0] AS 'Codigo Contable'\\n                                                                        ,ITM.[ITMDES1_0] AS 'Descripcion 1'\\n                                                                        ,ITM.[ITMDES2_0] AS 'Descripcion 2'\\n                                                                        ,ITM.[ITMDES3_0] AS 'Descripcion 3'\\n                                                                        ,ITM.[STU_0] AS Unidad\\n                                                                        ,ITM.[VACITM_0] AS 'Nivel Impuesto'\\n                                                                        ,ITM.[BUY_0] AS Comprador\\n                                                                        ,ITM.[PURBASPRI_0] AS 'Precio Base'\\n                                                                        ,ITM.[CPRCOE_0] AS 'Coef Gastos Entrega'\\n                                                                        ,ITM.[CPRAMT_0] AS 'Coste Fijo Unitario'\\n                                                                        ,ITM.[CCE_0] AS 'Eje Analitico 1'\\n                                                                        ,ITM.[CCE_1] AS 'Eje Analitico 2'\\n                                                                        ,ITM.[CCE_2] AS 'Eje Analitico 3'\\n                                                                        ,ITM.[CCE_3] AS 'Eje Analitico 4'\\n                                                                        ,ITM.TSICOD_0 AS 'Codigo Famlia Analisis'\\n                                                                        ,ITM.TSICOD_1 AS 'Codigo Subfamilia Analisis'\\n                                                                        ,TXT.TEXTE_0 AS Familia\\n                                                                        ,TXT2.TEXTE_0 AS Subfamilia\\n                                                                        ,ITMS.[MINQTY_0] AS 'Cantidad Minima'\\n                                                                        ,ITMS.[MAXQTY_0] AS 'Cantidad Máxima'\\n                                                                        ,ITMS.[MINPFM_0] AS 'Margen Minimo'\\n                                                                        ,ITMS.[MINPRI_0] AS 'Precio Minimo'\\n                                                                        ,ITMS.[THEPRI_0] AS 'Precio Teorico'\\n                                                                        ,ITMS.[BASPRI_0] AS 'Precio Base Ventas'\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t,(select top 1 ITS.BPSNUM_0 from \\\" & CurrentSchema & \\\".ITMBPS ITS where ITS.ITMREF_0 = ITM.ITMREF_0 and ITS.PIO_0 = 0) as Supplier\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t,(select top 1 ITS.ITMREFBPS_0 from \\\" & CurrentSchema & \\\".ITMBPS ITS where ITS.ITMREF_0 = ITM.ITMREF_0 and ITS.BPSNUM_0='\\\" & CurrentCompany &\\\"') as [Vygon Item Number]\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t,case when BPS.ITMREF_0 is null then 'N' else 'Y' end as 'Purchased from VYGON'\\n                                                                    FROM \\\" & CurrentSchema & \\\".ITMMASTER AS ITM\\n                                                                    LEFT JOIN \\\" & CurrentSchema & \\\".[ITMSALES] AS ITMS\\n                                                                    ON ITM.ITMREF_0 = ITMS.ITMREF_0\\n                                                                    LEFT JOIN \\\" & CurrentSchema & \\\".ATEXTRA as TXT\\n                                                                    on ITM.TSICOD_0 = TXT.IDENT2_0  AND CODFIC_0 = 'ATABDIV' AND ZONE_0 = 'LNGDES' AND IDENT1_0 = '20' AND LANGUE_0 = 'SPA'\\n                                                                    LEFT JOIN \\\" & CurrentSchema & \\\".ATEXTRA as TXT2\\n                                                                    on ITM.TSICOD_1 = TXT2.IDENT2_0 AND TXT2.CODFIC_0 = 'ATABDIV' AND TXT2.ZONE_0 = 'LNGDES' AND TXT2.IDENT1_0 = '21' AND TXT2.LANGUE_0 = 'SPA'\\n                                                                    LEFT JOIN \\\" & CurrentSchema & \\\".ATEXTRA AS TXCAT\\n                                                                    ON ITM.TCLCOD_0 = TXCAT.IDENT1_0 AND TXCAT.CODFIC_0 = 'ITMCATEG' AND TXCAT.ZONE_0 = 'TCLAXX' AND TXCAT.LANGUE_0 = 'SPA'\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tLEFT JOIN  PROTO.ITMBPS BPS on ITM.ITMREF_0=BPS.ITMREF_0  and BPS.BPSNUM_0='\\\" & CurrentCompany &\\\"'\\\"\\n                                                          ]),\\n    #\\\"Added Custom\\\" = Table.AddColumn(Origen, \\\"Subsidiary ID\\\", each \\\"ES\\\"),\\n    #\\\"Added Custom1\\\" = Table.AddColumn(#\\\"Added Custom\\\", \\\"EOR\\\", each \\\"EOR\\\"),\\n    #\\\"Renamed Columns\\\" = Table.RenameColumns(#\\\"Added Custom1\\\",{{\\\"Familia\\\", \\\"Business Unit\\\"}, {\\\"Codigo Famlia Analisis\\\", \\\"Codigo Business Unit Analisis\\\"}, {\\\"Codigo Subfamilia Analisis\\\", \\\"Codigo Familia Analisis\\\"}, {\\\"Subfamilia\\\", \\\"Familia\\\"}})\\nin\\n    #\\\"Renamed Columns\\\"\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Metricas",
      "lineageTag": "8f3050e2-9455-4ce9-a383-af94125f0237",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    Origen = Table.FromRows(Json.Document(Binary.Decompress(Binary.FromText(\"i44FAA==\", BinaryEncoding.Base64), Compression.Deflate)), let _t = ((type nullable text) meta [Serialized.Text = true]) in type table [Columna1 = _t]),",
        "    #\"Tipo cambiado\" = Table.TransformColumnTypes(Origen,{{\"Columna1\", type text}}),",
        "    #\"Columnas quitadas\" = Table.RemoveColumns(#\"Tipo cambiado\",{\"Columna1\"})",
        "in",
        "    #\"Columnas quitadas\""
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    Origen = Table.FromRows(Json.Document(Binary.Decompress(Binary.FromText(\\\"i44FAA==\\\", BinaryEncoding.Base64), Compression.Deflate)), let _t = ((type nullable text) meta [Serialized.Text = true]) in type table [Columna1 = _t]),\\n    #\\\"Tipo cambiado\\\" = Table.TransformColumnTypes(Origen,{{\\\"Columna1\\\", type text}}),\\n    #\\\"Columnas quitadas\\\" = Table.RemoveColumns(#\\\"Tipo cambiado\\\",{\\\"Columna1\\\"})\\nin\\n    #\\\"Columnas quitadas\\\"\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "UltimaActualizacion",
      "lineageTag": "fdc5c519-6885-4e84-b453-70be9be8df63",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    FechaHoraDeHoy = DateTime.From(DateTimeZone.SwitchZone(DateTimeZone.FixedLocalNow(),1)),",
        "    ConvierteATabla = #table(1, {{FechaHoraDeHoy}}),",
        "    RenombreColumna = Table.RenameColumns(ConvierteATabla,{{\"Column1\", \"Última actualización\"}}),",
        "    TipoFechaHora = Table.TransformColumnTypes(RenombreColumna,{{\"Última actualización\", type datetime}}),",
        "    #\"Columnas con nombre cambiado\" = Table.RenameColumns(TipoFechaHora,{{\"Última actualización\", \"Fecha\"}})",
        "in",
        "    #\"Columnas con nombre cambiado\""
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    FechaHoraDeHoy = DateTime.From(DateTimeZone.SwitchZone(DateTimeZone.FixedLocalNow(),1)),\\n    ConvierteATabla = #table(1, {{FechaHoraDeHoy}}),\\n    RenombreColumna = Table.RenameColumns(ConvierteATabla,{{\\\"Column1\\\", \\\"Última actualización\\\"}}),\\n    TipoFechaHora = Table.TransformColumnTypes(RenombreColumna,{{\\\"Última actualización\\\", type datetime}}),\\n    #\\\"Columnas con nombre cambiado\\\" = Table.RenameColumns(TipoFechaHora,{{\\\"Última actualización\\\", \\\"Fecha\\\"}})\\nin\\n    #\\\"Columnas con nombre cambiado\\\"\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Segmentos",
      "lineageTag": "6a2f68e8-1757-4a92-b9c9-2dc3671c2434",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    Origen = Table.FromRows(Json.Document(Binary.Decompress(Binary.FromText(\"bdDBCsIwDAbgd+l5F7PkIQQVEW9jhzKCBMoidu7g0ytbDWzpoYd8/D8N6bpwHOMwyaw5NOGwvL7xCk6hmgXL3oTzQ0u99YSeaEvgi+CLYMWzzpLkE19L77/dXqGq6z8njolzIfREW0KfQktd3ryeBG0VIzK66sTjIDGVIFS1dUrVLFn2rs8y427+bdd/AQ==\", BinaryEncoding.Base64), Compression.Deflate)), let _t = ((type nullable text) meta [Serialized.Text = true]) in type table [Segmento = _t, Recencia = _t, Frecuencia = _t]),",
        "    #\"Tipo cambiado\" = Table.TransformColumnTypes(Origen,{{\"Segmento\", type text}, {\"Recencia\", Int64.Type}, {\"Frecuencia\", Int64.Type}}),",
        "    #\"Personalizada agregada\" = Table.AddColumn(#\"Tipo cambiado\", \"RF\", each [Recencia] & \" - \" & [Frecuencia]),",
        "    #\"Columnas quitadas\" = Table.RemoveColumns(#\"Personalizada agregada\",{\"RF\"}),",
        "    #\"Personalizada agregada1\" = Table.AddColumn(#\"Columnas quitadas\", \"Personalizado\", each Text.Combine([Recencia], [Frecuencia])),",
        "    #\"Columnas quitadas1\" = Table.RemoveColumns(#\"Personalizada agregada1\",{\"Personalizado\"}),",
        "    #\"Personalizada agregada2\" = Table.AddColumn(#\"Columnas quitadas1\", \"RF\", each [Recencia] & [Frecuencia]),",
        "    #\"Columnas quitadas2\" = Table.RemoveColumns(#\"Personalizada agregada2\",{\"RF\"}),",
        "    #\"Personalizada agregada3\" = Table.AddColumn(#\"Columnas quitadas2\", \"Personalizado\", each [Recencia] + \" - \" + [Frecuencia]),",
        "    #\"Columnas quitadas3\" = Table.RemoveColumns(#\"Personalizada agregada3\",{\"Personalizado\"}),",
        "    #\"Personalizada agregada4\" = Table.AddColumn(#\"Columnas quitadas3\", \"Personalizado\", each Number.ToText([Recencia]) & \"-\" & Number.ToText([Frecuencia])),",
        "    #\"Columnas con nombre cambiado\" = Table.RenameColumns(#\"Personalizada agregada4\",{{\"Personalizado\", \"RF\"}})",
        "in",
        "    #\"Columnas con nombre cambiado\""
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    Origen = Table.FromRows(Json.Document(Binary.Decompress(Binary.FromText(\\\"bdDBCsIwDAbgd+l5F7PkIQQVEW9jhzKCBMoidu7g0ytbDWzpoYd8/D8N6bpwHOMwyaw5NOGwvL7xCk6hmgXL3oTzQ0u99YSeaEvgi+CLYMWzzpLkE19L77/dXqGq6z8njolzIfREW0KfQktd3ryeBG0VIzK66sTjIDGVIFS1dUrVLFn2rs8y427+bdd/AQ==\\\", BinaryEncoding.Base64), Compression.Deflate)), let _t = ((type nullable text) meta [Serialized.Text = true]) in type table [Segmento = _t, Recencia = _t, Frecuencia = _t]),\\n    #\\\"Tipo cambiado\\\" = Table.TransformColumnTypes(Origen,{{\\\"Segmento\\\", type text}, {\\\"Recencia\\\", Int64.Type}, {\\\"Frecuencia\\\", Int64.Type}}),\\n    #\\\"Personalizada agregada\\\" = Table.AddColumn(#\\\"Tipo cambiado\\\", \\\"RF\\\", each [Recencia] & \\\" - \\\" & [Frecuencia]),\\n    #\\\"Columnas quitadas\\\" = Table.RemoveColumns(#\\\"Personalizada agregada\\\",{\\\"RF\\\"}),\\n    #\\\"Personalizada agregada1\\\" = Table.AddColumn(#\\\"Columnas quitadas\\\", \\\"Personalizado\\\", each Text.Combine([Recencia], [Frecuencia])),\\n    #\\\"Columnas quitadas1\\\" = Table.RemoveColumns(#\\\"Personalizada agregada1\\\",{\\\"Personalizado\\\"}),\\n    #\\\"Personalizada agregada2\\\" = Table.AddColumn(#\\\"Columnas quitadas1\\\", \\\"RF\\\", each [Recencia] & [Frecuencia]),\\n    #\\\"Columnas quitadas2\\\" = Table.RemoveColumns(#\\\"Personalizada agregada2\\\",{\\\"RF\\\"}),\\n    #\\\"Personalizada agregada3\\\" = Table.AddColumn(#\\\"Columnas quitadas2\\\", \\\"Personalizado\\\", each [Recencia] + \\\" - \\\" + [Frecuencia]),\\n    #\\\"Columnas quitadas3\\\" = Table.RemoveColumns(#\\\"Personalizada agregada3\\\",{\\\"Personalizado\\\"}),\\n    #\\\"Personalizada agregada4\\\" = Table.AddColumn(#\\\"Columnas quitadas3\\\", \\\"Personalizado\\\", each Number.ToText([Recencia]) & \\\"-\\\" & Number.ToText([Frecuencia])),\\n    #\\\"Columnas con nombre cambiado\\\" = Table.RenameColumns(#\\\"Personalizada agregada4\\\",{{\\\"Personalizado\\\", \\\"RF\\\"}})\\nin\\n    #\\\"Columnas con nombre cambiado\\\"\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Proyectos",
      "lineageTag": "49e0b423-2b60-490a-92ab-6c15f2e57c80",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "                                                                SELECT  *",
        "                                                                FROM \" & CurrentSchema & \".ZPROYECI\"",
        "                                                          ])",
        "in",
        "    Origen"
      ],
      "loadAsTableDisabled": true,
      "resultType": "Exception",
      "isHidden": false
    },
    {
      "name": "General Posting Setup",
      "lineageTag": "e8a585ae-eebc-4da9-9fb4-80baca848c6e",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "                                                                SELECT  -1 AS sk_Cuenta,",
        "                                                                        '-1' as idCuenta,",
        "                                                                        'Indefinida' as Cuenta,",
        "                                                                        '-1' as [No Cuenta],",
        "                                                                        -1 as Grupo,",
        "                                                                        'INDEFINIDA' AS NombreBusqueda,",
        "                                                                        0 as Indentacion,",
        "                                                                        'Indefinido' as GrupoCuenta ",
        "                                                                        ",
        "                                                                    union all ",
        "                                                                ",
        "                                                                SELECT  A.ACC_0 as sk_Cuenta, ",
        "                                                                        A.ACC_0 + '#2' AS idCuenta, ",
        "                                                                        A.DES_0 AS Cuenta, ",
        "                                                                        A.ACC_0 as [No Cuenta], ",
        "                                                                        LEFT(A.ACC_0,1) AS Grupo, ",
        "                                                                        UPPER(A.DES_0) as NombreBusqueda,",
        "                                                                        0 as Indentacion,",
        "                                                                        CASE LEFT(LTRIM(RTRIM(A.ACC_0)), 1) WHEN '1' THEN '1.- Financiación Básica' ",
        "                                                                                                            WHEN '2' THEN '2.- Inmovilizado' ",
        "                                                                                                            WHEN '3' THEN '3.- Existencias' ",
        "                                                                                                            WHEN '4' THEN '4.- Acreedores y Deudores' ",
        "                                                                                                            WHEN '5' THEN '5.- Cuentas Financieras' ",
        "                                                                                                            WHEN '6' THEN '6.- Compras y Gastos' ",
        "                                                                                                            WHEN '7' THEN '7.- Ventas e Ingresos' ",
        "                                                                                                            WHEN '8' THEN '8.- Gastos del Patrimonio Neto' ",
        "                                                                                                            WHEN '9' THEN '9.- Ingresos del Patrimonio Neto' ",
        "                                                                        END AS GrupoCuenta ",
        "                                                                FROM \" & CurrentSchema & \".GACCOUNT AS A WHERE COA_0 = 'SPA' \"",
        "                                                          ])",
        "in",
        "    Origen"
      ],
      "loadAsTableDisabled": true,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Resourcce",
      "lineageTag": "663e9a20-f85b-4954-b9b4-0f6025397e68",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "                                                                SELECT  *",
        "                                                                FROM \" & CurrentSchema & \".CACCE WHERE DIE_0 = 'REC'\"",
        "                                                          ])",
        "in",
        "    Origen"
      ],
      "loadAsTableDisabled": true,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Product Group",
      "lineageTag": "5c5819ad-b9b1-4c05-a0e9-1a1d768de858",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "                                                                SELECT IDENT1_0, IDENT2_0, TEXTE_0 FROM \"& CurrentSchema &\".ATEXTRA WHERE CODFIC_0 = 'ATABDIV' AND ZONE_0 = 'LNGDES' AND IDENT1_0 IN ('20', '21', '22')\"",
        "                                                          ])",
        "in",
        "    Origen"
      ],
      "loadAsTableDisabled": true,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Analitica Facturas",
      "lineageTag": "1fcfe6cd-8d8c-4f5c-8f57-17336535ac97",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "SELECT ",
        "VCRNUM_0 as Documento, ",
        "VCRLIN_0 as Linea,",
        "COA_0 as PlanCuentas, ",
        "ACC_0 as CuentaContable,",
        "DIE_0 as CodEje1,",
        "CCE_0 as EjeAnalitico1,",
        "DIE_1 as CodEje2, ",
        "CCE_1 as EjeAnalitico2, ",
        "DIE_2 as CodEje3, ",
        "CCE_2 as EjeAnalitico3, ",
        "DIE_3 as CodEje4, ",
        "CCE_3 as EjeAnalitico4, ",
        "DIE_4 as CodEje5, ",
        "CCE_4 as EjeAnalitico5,",
        "DIE_5 as CodEje6,  ",
        "CCE_5 as EjeAnalitico6, ",
        "DIE_6 as CodEje7, ",
        "CCE_6 as EjeAnalitico7, ",
        "DIE_7 as CodEje8, ",
        "CCE_7 as EjeAnalitico8, ",
        "DIE_8 as CodEje9, ",
        "CCE_8 as EjeAnalitico9, ",
        "DIE_9 as CodEje10, ",
        "CCE_9 as EjeAnalitico10",
        "",
        "                                                                    FROM \" & CurrentSchema &\".CPTANALIN",
        "                                                                    WHERE ABRFIC_0 = 'SID'\"",
        "                                                          ])",
        "   ",
        "in Origen"
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    CurrentServer = Instancia,\\n    CurrentDatabase = BaseDeDatos,\\n    CurrentSchema = Esquema,\\n    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\\\"\\nSELECT \\nVCRNUM_0 as Documento, \\nVCRLIN_0 as Linea,\\nCOA_0 as PlanCuentas, \\nACC_0 as CuentaContable,\\nDIE_0 as CodEje1,\\nCCE_0 as EjeAnalitico1,\\nDIE_1 as CodEje2, \\nCCE_1 as EjeAnalitico2, \\nDIE_2 as CodEje3, \\nCCE_2 as EjeAnalitico3, \\nDIE_3 as CodEje4, \\nCCE_3 as EjeAnalitico4, \\nDIE_4 as CodEje5, \\nCCE_4 as EjeAnalitico5,\\nDIE_5 as CodEje6,  \\nCCE_5 as EjeAnalitico6, \\nDIE_6 as CodEje7, \\nCCE_6 as EjeAnalitico7, \\nDIE_7 as CodEje8, \\nCCE_7 as EjeAnalitico8, \\nDIE_8 as CodEje9, \\nCCE_8 as EjeAnalitico9, \\nDIE_9 as CodEje10, \\nCCE_9 as EjeAnalitico10\\n\\n                                                                    FROM \\\" & CurrentSchema &\\\".CPTANALIN\\n                                                                    WHERE ABRFIC_0 = 'SID'\\\"\\n                                                          ])\\n   \\nin Origen\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Provincias",
      "lineageTag": "a52de956-6ddf-41a9-905d-f62afe9142c8",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    Source = Table.FromRows(Json.Document(Binary.Decompress(Binary.FromText(\"TVJBTiQxDPxKxJlPwAgGVs0uYkYcQBw8HW8rI3e8cndaon/DkQOHFU/oj+HBzgy3qtgplyt5fj67CCuWsvyHs5dzZQRTRTtocUQnqYV8JD3K8uFtw1gkwWBkSmTHlxBhz7NjaZE4e6VIx9a+Wt5aFDySmOzCSkfBTlWdDSMSLZ/ZKJbRC6lEiOEBgVzhUyLvvFgwtwavWXpU82J0naR6WQtkNWq4KCLYQ20r6V+ZWzZ2U5CmIxxc+XaXZkO/YHk3fw2Eh8T704Cg60Bd5rqgjDipneJzGsgzCHu2DdY9m+VdkntrSsff4A6iHhpc3gg68GMiFjd1h/mEi7Q++bc+rPjMP4J5sIH3QBqU99xzPpiL3rbRPHqoMW4xo6S/WLdcc4/HHYLq9EauKNwkFDHHG+x4cvkN6v/wD7LhGsn2YKurT7JF0agNMmE0lcefLpUQRCYP4jHNLbxa6Ql6lgoPqv48twPBEC5VBep/+zYcIoZTeC9f\", BinaryEncoding.Base64), Compression.Deflate)), let _t = ((type nullable text) meta [Serialized.Text = true]) in type table [Provincias = _t]),",
        "    #\"Changed Type\" = Table.TransformColumnTypes(Source,{{\"Provincias\", type text}}),",
        "    #\"Sorted Rows\" = Table.Sort(#\"Changed Type\",{{\"Provincias\", Order.Ascending}})",
        "in",
        "    #\"Sorted Rows\""
      ],
      "loadAsTableDisabled": true,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Instancia",
      "lineageTag": "bc882005-270d-4f6e-a735-9201221656bc",
      "description": "Obligatorio:\nServidor en el que se aloja la Base de datos",
      "queryGroupId": "f238ac0c-f995-429f-83dd-4e48d95546e0",
      "navigationStepName": "Navegación",
      "text": [
        "\"10.0.0.16\\SAGEX3\" meta [IsParameterQuery=true, Type=\"Text\", IsParameterQueryRequired=true]"
      ],
      "loadAsTableDisabled": true,
      "resultType": "Text",
      "isHidden": false
    },
    {
      "name": "BaseDeDatos",
      "lineageTag": "a1a82060-5be5-45e3-8782-106ec59ff066",
      "description": "Obligatorio:\nBase de datos donde se encuentra la información de Sage x3",
      "queryGroupId": "f238ac0c-f995-429f-83dd-4e48d95546e0",
      "navigationStepName": "Navegación",
      "text": [
        "\"sagex3v12\" meta [IsParameterQuery=true, Type=\"Text\", IsParameterQueryRequired=true]"
      ],
      "loadAsTableDisabled": true,
      "resultType": "Text",
      "isHidden": false
    },
    {
      "name": "Esquema",
      "lineageTag": "761542c4-251b-4873-8fb8-f02c6707feb2",
      "description": "Obligatorio:\nEsquema de la Base de Datos",
      "queryGroupId": "f238ac0c-f995-429f-83dd-4e48d95546e0",
      "navigationStepName": "Navigation",
      "text": [
        "\"LASERTECH\" meta [IsParameterQuery=true, Type=\"Text\", IsParameterQueryRequired=true]"
      ],
      "loadAsTableDisabled": true,
      "resultType": "Text",
      "isHidden": false
    },
    {
      "name": "Registros",
      "lineageTag": "a4663608-c6ff-4f8d-9b8b-107452dcf83f",
      "description": "Opcional:\nNº máximo de registros que se cargarán en el modelo. \n\nAVISO: Si el modelo supera los 120.000.000 de registros, no se podrá publicar en el servidor ya que el límite de tamaño es de 1GB.",
      "queryGroupId": "f238ac0c-f995-429f-83dd-4e48d95546e0",
      "navigationStepName": "Navigation",
      "text": [
        "\"120000000\" meta [IsParameterQuery=true, List={\"120000000\"}, DefaultValue=\"120000000\", Type=\"Text\", IsParameterQueryRequired=false]"
      ],
      "loadAsTableDisabled": true,
      "resultType": "Text",
      "isHidden": false
    },
    {
      "name": "Periodo",
      "lineageTag": "e61ac979-a551-45cf-8498-39bc1ba5af54",
      "description": "Opcional:\nAño a partir del cual se van a cargar los registros. Por ejemplo, si introducimos \"2010\", se cargará toda la información desde el 2010 hasta el presente. \n\nSi no seleccionas un periodo, el modelo cargará automaticamente el número de años adecuado a la capacidad de almacenaje del modelo.",
      "queryGroupId": "f238ac0c-f995-429f-83dd-4e48d95546e0",
      "navigationStepName": "Navigation",
      "text": [
        "\"Periodo automático\" meta [IsParameterQuery=true, List={\"Periodo automático\"}, DefaultValue=\"Periodo automático\", Type=\"Text\", IsParameterQueryRequired=false]"
      ],
      "loadAsTableDisabled": true,
      "resultType": "Text",
      "isHidden": false
    },
    {
      "name": "Registros_Year",
      "lineageTag": "f492c6de-2e02-468f-8ec4-457031129351",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    CurrentRows = Registros,",
        "    CurrentPeriod = Periodo,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"",
        "",
        "",
        "DECLARE @ANO1 VARCHAR(20)",
        "DECLARE @ANO2 int",
        "set @ANO1='\"& CurrentPeriod &\"'",
        "set @ANO2=(SELECT MIN(PERIODO) FROM (\tSELECT YEAR(ACCDAT_0) AS PERIODO,COUNT(*) AS REGISTROS,",
        "\t\t\t\t\t\t\t\t\t\tSUM(COUNT(*)) OVER (ORDER BY YEAR(ACCDAT_0) DESC) AS ACUMULADO",
        "\t\t\t\t\t\t\t\t\t\tFROM \" & CurrentSchema &\".SINVOICED as SED left join \" & CurrentSchema &\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0",
        "\t\t\t\t\t\t\t\t\t\twhere SE.ORIMOD_0=5 ",
        "\t\t\t\t\t\t\t\t\t\tGROUP BY YEAR(ACCDAT_0)",
        "\t\t\t\t\t\t\t\t\t\t) A\tWHERE ACUMULADO <=\" & CurrentRows &\")",
        "\t\t\t\t\t\t\t\t\t\t",
        "",
        "IF @ANO1='Periodo automático'",
        "",
        "SELECT ",
        "YEAR(ACCDAT_0) AS PERIODO,",
        "COUNT(*) AS REGISTROS,",
        "SUM(COUNT(*)) OVER (ORDER BY YEAR(ACCDAT_0) DESC) AS ACUMULADO,",
        "@ANO1 as PERIODO_SELECCIONADO,",
        "@ANO2 as PERIODO_RECOMENDADO,",
        "\" & CurrentRows &\" as MAX_REGISTROS",
        "",
        "FROM \" & CurrentSchema &\".SINVOICED as SED left join \" & CurrentSchema &\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0",
        "where SE.ORIMOD_0=5 AND YEAR(ACCDAT_0)>=@ANO2",
        "",
        "GROUP BY YEAR(ACCDAT_0)",
        "ORDER BY YEAR(ACCDAT_0) DESC",
        "",
        "",
        "ELSE",
        "",
        "",
        "SELECT ",
        "YEAR(ACCDAT_0) AS PERIODO,",
        "COUNT(*) AS REGISTROS,",
        "SUM(COUNT(*)) OVER (ORDER BY YEAR(ACCDAT_0) DESC) AS ACUMULADO,",
        "@ANO1 as PERIODO_SELECCIONADO,",
        "@ANO2 as PERIODO_RECOMENDADO,",
        "\" & CurrentRows &\" as MAX_REGISTROS",
        "",
        "FROM \" & CurrentSchema &\".SINVOICED as SED left join \" & CurrentSchema &\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0",
        "where SE.ORIMOD_0=5 AND YEAR(ACCDAT_0)>=@ANO1 ",
        "",
        "GROUP BY YEAR(ACCDAT_0)",
        "ORDER BY YEAR(ACCDAT_0) DESC",
        "",
        "",
        "",
        "        \"",
        "                                                          ]),",
        "                                                          ",
        " #\"Changed Type\" = Table.TransformColumnTypes(Origen,{{\"MAX_REGISTROS\", Int64.Type}})",
        "   ",
        "in",
        "    #\"Changed Type\""
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    CurrentServer = Instancia,\\n    CurrentDatabase = BaseDeDatos,\\n    CurrentSchema = Esquema,\\n    CurrentRows = Registros,\\n    CurrentPeriod = Periodo,\\n    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\\\"\\n\\n\\nDECLARE @ANO1 VARCHAR(20)\\nDECLARE @ANO2 int\\nset @ANO1='\\\"& CurrentPeriod &\\\"'\\nset @ANO2=(SELECT MIN(PERIODO) FROM (\\tSELECT YEAR(ACCDAT_0) AS PERIODO,COUNT(*) AS REGISTROS,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tSUM(COUNT(*)) OVER (ORDER BY YEAR(ACCDAT_0) DESC) AS ACUMULADO\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tFROM \\\" & CurrentSchema &\\\".SINVOICED as SED left join \\\" & CurrentSchema &\\\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\twhere SE.ORIMOD_0=5 \\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tGROUP BY YEAR(ACCDAT_0)\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t) A\\tWHERE ACUMULADO <=\\\" & CurrentRows &\\\")\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\n\\nIF @ANO1='Periodo automático'\\n\\nSELECT \\nYEAR(ACCDAT_0) AS PERIODO,\\nCOUNT(*) AS REGISTROS,\\nSUM(COUNT(*)) OVER (ORDER BY YEAR(ACCDAT_0) DESC) AS ACUMULADO,\\n@ANO1 as PERIODO_SELECCIONADO,\\n@ANO2 as PERIODO_RECOMENDADO,\\n\\\" & CurrentRows &\\\" as MAX_REGISTROS\\n\\nFROM \\\" & CurrentSchema &\\\".SINVOICED as SED left join \\\" & CurrentSchema &\\\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0\\nwhere SE.ORIMOD_0=5 AND YEAR(ACCDAT_0)>=@ANO2\\n\\nGROUP BY YEAR(ACCDAT_0)\\nORDER BY YEAR(ACCDAT_0) DESC\\n\\n\\nELSE\\n\\n\\nSELECT \\nYEAR(ACCDAT_0) AS PERIODO,\\nCOUNT(*) AS REGISTROS,\\nSUM(COUNT(*)) OVER (ORDER BY YEAR(ACCDAT_0) DESC) AS ACUMULADO,\\n@ANO1 as PERIODO_SELECCIONADO,\\n@ANO2 as PERIODO_RECOMENDADO,\\n\\\" & CurrentRows &\\\" as MAX_REGISTROS\\n\\nFROM \\\" & CurrentSchema &\\\".SINVOICED as SED left join \\\" & CurrentSchema &\\\".SINVOICE AS SE on SED.NUM_0 = SE.NUM_0\\nwhere SE.ORIMOD_0=5 AND YEAR(ACCDAT_0)>=@ANO1 \\n\\nGROUP BY YEAR(ACCDAT_0)\\nORDER BY YEAR(ACCDAT_0) DESC\\n\\n\\n\\n        \\\"\\n                                                          ]),\\n                                                          \\n #\\\"Changed Type\\\" = Table.TransformColumnTypes(Origen,{{\\\"MAX_REGISTROS\\\", Int64.Type}})\\n   \\nin\\n    #\\\"Changed Type\\\"\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Stock",
      "lineageTag": "81bc4502-cf87-439c-9a28-a7b8535b38c0",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    CurrentRows = Registros,",
        "    CurrentPeriod = Periodo,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"select ITMREF_0, sum(PHYSTO_0) as 'Quantity' ",
        ", sum(PHYSTO_0*AVC_0) as 'Value' , max(AVC_0) as 'Standard Cost'",
        "from \" & CurrentSchema &\".ITMMVT",
        "group by ITMREF_0",
        "        \"",
        "                                                          ])",
        "in",
        "    Origen"
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    CurrentServer = Instancia,\\n    CurrentDatabase = BaseDeDatos,\\n    CurrentSchema = Esquema,\\n    CurrentRows = Registros,\\n    CurrentPeriod = Periodo,\\n    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\\\"select ITMREF_0, sum(PHYSTO_0) as 'Quantity' \\n, sum(PHYSTO_0*AVC_0) as 'Value' , max(AVC_0) as 'Standard Cost'\\nfrom \\\" & CurrentSchema &\\\".ITMMVT\\ngroup by ITMREF_0\\n        \\\"\\n                                                          ])\\nin\\n    Origen\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Price",
      "lineageTag": "234d2824-c1e0-421d-84ee-017b0d8e4fef",
      "navigationStepName": "Navigation",
      "text": [
        "let",
        "    CurrentServer = Instancia,",
        "    CurrentDatabase = BaseDeDatos,",
        "    CurrentSchema = Esquema,",
        "    CurrentRows = Registros,",
        "    CurrentPeriod = Periodo,",
        "    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\"select PPL.PLICRI2_0 as [ITMREF_0], PPL.PRI_0 as 'Purchase price'",
        "from \" & CurrentSchema &\".PPRICLIST PPL",
        "where PPL.PLI_0 = 'T20'",
        "and PPL.PLICRI1_0 = (select top 1 ITS.BPSNUM_0 from PROTO.ITMBPS ITS where ITS.ITMREF_0 = PPL.PLICRI2_0 and ITS.PIO_0 = 0)",
        "and PPL.PLISTRDAT_0 <= GETDATE()",
        "and PPL.PLIENDDAT_0 >= GETDATE()",
        "        \"",
        "                                                          ])",
        "in",
        "    Origen"
      ],
      "isDirectQuery": false,
      "lastLoadedAsTableFormulaText": "{\"IncludesReferencedQueries\":false,\"RootFormulaText\":\"let\\n    CurrentServer = Instancia,\\n    CurrentDatabase = BaseDeDatos,\\n    CurrentSchema = Esquema,\\n    CurrentRows = Registros,\\n    CurrentPeriod = Periodo,\\n    Origen = Sql.Database(CurrentServer, CurrentDatabase, [Query=\\\"select PPL.PLICRI2_0 as [ITMREF_0], PPL.PRI_0 as 'Purchase price'\\nfrom \\\" & CurrentSchema &\\\".PPRICLIST PPL\\nwhere PPL.PLI_0 = 'T20'\\nand PPL.PLICRI1_0 = (select top 1 ITS.BPSNUM_0 from PROTO.ITMBPS ITS where ITS.ITMREF_0 = PPL.PLICRI2_0 and ITS.PIO_0 = 0)\\nand PPL.PLISTRDAT_0 <= GETDATE()\\nand PPL.PLIENDDAT_0 >= GETDATE()\\n        \\\"\\n                                                          ])\\nin\\n    Origen\",\"ReferencedQueriesFormulaText\":{}}",
      "loadAsTableDisabled": false,
      "resultType": "Table",
      "isHidden": false
    },
    {
      "name": "Empresa",
      "lineageTag": "d06f8ca6-7d86-41b2-9b91-51cb228963de",
      "queryGroupId": "f238ac0c-f995-429f-83dd-4e48d95546e0",
      "navigationStepName": "Navigation",
      "text": [
        "null meta [IsParameterQuery=true, Type=\"Any\", IsParameterQueryRequired=true]"
      ],
      "loadAsTableDisabled": true,
      "resultType": "Null",
      "isHidden": false
    }
  ],
  "queryGroups": [
    {
      "name": "Auxiliares",
      "id": "f238ac0c-f995-429f-83dd-4e48d95546e0",
      "description": ""
    }
  ],
  "culture": "es-ES",
  "firewallEnabled": true
}